# Results from the Megafauna Demo Simulator

Each aggregation unit (habitat group) comprises several habitats.
Since all habitats have the same properties and there is no stochasticity, the curves from all aggregation units look the same.

```{r include = FALSE}
library(ggplot2)
library(tidyr)

# READ TABLES

read_generic_table <- function(filename){
  if (!file.exists(filename))
    stop("File does not exist: ", filename)
  tbl <- read.csv(filename, sep = "\t")
  # Handle daily output.
  if ("day" %in% colnames(tbl)) {
    tbl$year <- tbl$year + tbl$day/365
    tbl$day <- NULL
  }
  return(tbl)
}

read_per_forage_type_table <- function(filename){
  read_generic_table(filename) %>%
  gather(key = forage_type, value = VALUE, -year, -agg_unit)
}

read_per_hft_table <- function(filename){
  read_generic_table(filename) %>%
  gather(key = HFT, value = VALUE, -year, -agg_unit)
}

read_per_hft_per_forage_table <- function(filename){
  read_generic_table(filename) %>%
  gather(key = HFT, value = VALUE, -forage_type, -year, -agg_unit)
}

available.tbl <- read_per_forage_type_table("available_forage.tsv")
available.tbl$VALUE <- available.tbl$VALUE * 10^-6 # convert kg/km² to kg/m²

mass.tbl <- read_per_hft_table("mass_density_per_hft.tsv")
mass.tbl$VALUE <- mass.tbl$VALUE / 100 # convert kg/km² to kg/ha

eaten.tbl <- read_per_hft_per_forage_table("eaten_forage_per_ind.tsv")

# `timestep` is the output interval: a day, a year, (roughly) a month, or a decade.
unique_years.v <- sort(unique(mass.tbl$year))
timestep <- abs(unique_years.v[2] - unique_years.v[1])
```

```{r fig.cap = "Mass Density", echo = FALSE}
# We plot the points not in the beginning of each time step, but in the middle.
ggplot(mass.tbl, aes(x = year + timestep / 2, y = VALUE, color = HFT)) +
  geom_line() +
  coord_cartesian(xlim = c(min(mass.tbl$year), max(mass.tbl$year) + timestep)) +
  facet_wrap(~agg_unit) +
  expand_limits(y = 0) +
  labs(
    x = "Simulation Year",
    y = "Mean Mass Density [kg/ha]",
    title = "Mass Density per Habitat Group"
  )
```

```{r fig.cap = "Eaten Forage per Individual", echo = FALSE}
ggplot(eaten.tbl, aes(x = year + timestep / 2, y = VALUE, color = HFT, linetype = forage_type)) +
  geom_line() +
  coord_cartesian(xlim = c(min(eaten.tbl$year), max(eaten.tbl$year) + timestep)) +
  facet_wrap(~agg_unit) +
  expand_limits(y = 0) +
  labs(
    x = "Simulation Year",
    y = "Eaten Forage per Individual [kgDM/ind/day]",
    title = "Eaten Forage per Individual"
  )
```

```{r fig.cap = "Available Forage", echo = FALSE}
ggplot(available.tbl, aes(x = year + timestep / 2, y = VALUE, color = forage_type)) +
  geom_line() +
  coord_cartesian(xlim = c(min(available.tbl$year), max(available.tbl$year) + timestep)) +
  facet_wrap(~agg_unit) +
  expand_limits(y = 0) +
  labs(
    x = "Simulation Year",
    y = "Available Forage [kgDM/m²]",
    title = "Edible Forage Available to Herbivores"
  )
```

